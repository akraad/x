<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ابزارک‌های هوشمند</title>
    
    <link href="https://cdn.fontcdn.ir/Font/Persian/Shabnam/Shabnam.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        body {
            font-family: 'Shabnam', 'Vazirmatn', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Navigation Bar Styles (Minimal & Blue) --- */
        .navbar {
            display: flex;
            justify-content: center;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            padding: 8px 12px; /* Smallest padding */
            margin-bottom: 20px; /* Less margin */
            width: 100%;
            max-width: 600px; /* Wider for 4 buttons */
            flex-wrap: wrap;
        }
        .nav-button {
            background-color: #007bff; /* Blue */
            color: white; /* White text */
            padding: 7px 14px; /* Even smaller padding */
            border: none;
            border-radius: 5px; /* Slightly less rounded */
            font-size: 0.85em; /* Smaller font */
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 3px; /* Smaller margin */
            flex-grow: 1;
            max-width: 140px; /* Adjusted max-width */
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-button:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
        .nav-button.active {
            background-color: #0056b3; /* Darker blue when active */
            box-shadow: 0 1px 6px rgba(0, 123, 255, 0.4); /* Blue shadow */
        }
        .nav-button i {
            margin-left: 5px; /* Smaller margin */
            font-size: 0.9em; /* Consistent icon size */
        }

        /* --- Common Form Styles (Minimal & Classic) --- */
        .app-container {
            background-color: #fff;
            border-radius: 10px; /* Slightly less rounded */
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.07); /* Less pronounced shadow */
            padding: 25px; /* Reduced padding */
            width: 100%;
            max-width: 380px; /* Smaller overall width */
            text-align: center;
            border: 1px solid #e0e0e0; /* Lighter border */
            display: none;
            transition: all 0.3s ease-in-out; /* Smooth transition */
        }
        .app-container h1 {
            margin-bottom: 20px; /* Reduced margin */
            font-size: 1.7em; /* Smaller heading */
            font-weight: 700;
            color: #444; /* Darker, more classic text color */
        }
        .input-group {
            margin-bottom: 15px; /* Reduced margin */
            text-align: right;
            position: relative;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px; /* Reduced margin */
            font-size: 0.9em; /* Smaller label font */
            color: #555;
        }
        .input-group input[type="number"],
        .input-group input[type="text"],
        .input-group select {
            width: calc(100% - 35px); /* Adjusted width */
            padding: 9px 9px 9px 30px; /* Reduced padding */
            border: 1px solid #bbb; /* Slightly darker border */
            border-radius: 5px; /* Less rounded */
            font-size: 0.9em; /* Smaller input font */
            direction: ltr;
            text-align: right;
            transition: border-color 0.2s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: left 8px center; /* Adjusted icon position */
            background-size: 14px; /* Smaller icon */
            padding-left: 35px; /* Adjusted padding for icon */
        }

        .input-group select {
            width: calc(100% - 15px); /* Adjusted width for select */
            padding-left: 8px;
            direction: rtl;
            background-position: left 8px center;
            background-size: 14px;
            cursor: pointer; /* Indicate it's clickable */
        }
        .input-group select option {
            padding: 5px; /* Padding for options */
        }

        .input-group input[type="number"]:focus,
        .input-group input[type="text"]:focus,
        .input-group select:focus {
            outline: none;
            border-color: #007bff; /* Blue focus color */
        }
        .input-group .icon {
            position: absolute;
            left: 8px; /* Adjusted icon position */
            top: 50%;
            transform: translateY(calc(-50% + 8px)); /* Adjusted transform */
            color: #888;
            font-size: 1em; /* Smaller icon */
        }
        .input-group small {
            display: block;
            margin-top: 3px; /* Reduced margin */
            color: #888;
            font-size: 0.75em; /* Smaller hint font */
        }
        .weight-inputs, .date-inputs, .fortune-inputs { /* Added fortune-inputs */
            display: flex;
            gap: 8px; /* Reduced gap */
        }
        .weight-inputs .input-group, 
        .date-inputs .input-group,
        .fortune-inputs .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        .app-container button {
            color: white;
            padding: 10px 18px; /* Reduced padding */
            border: none;
            border-radius: 5px;
            font-size: 1em; /* Smaller font */
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
            font-weight: 600; /* Medium bold */
            margin-top: 18px; /* Reduced margin */
        }
        .app-container button:hover {
            opacity: 0.9;
        }
        .result {
            margin-top: 20px; /* Reduced margin */
            background-color: #f8f8f8; /* Lighter background */
            border: 1px solid #e8e8e8; /* Lighter border */
            border-radius: 7px; /* Less rounded */
            padding: 16px; /* Reduced padding */
            font-size: 1.1em; /* Slightly smaller result font */
            color: #333;
            font-weight: 600;
            display: none;
            text-align: right;
            line-height: 1.6; /* Better readability */
        }
        .result div {
            margin-bottom: 6px; /* Reduced margin */
        }
        .result span {
            font-size: 0.95em; /* Consistent font size */
            margin-right: 5px;
            font-weight: 700;
        }
        .fortune-text {
            font-size: 1.05em; /* Slightly larger for readability */
            font-weight: normal;
            margin-top: 15px;
            text-align: justify; /* Justify text for better appearance */
            background-color: #fdfdfd;
            border: 1px dashed #ddd; /* Dashed border for classic look */
            padding: 15px;
            border-radius: 8px;
            color: #444;
        }


        /* --- Specific Form Colors --- */

        /* Gold Calculator */
        #goldCalculator { border-color: #e0e0e0; }
        #goldCalculator h1 { color: #b8860b; }
        #goldCalculator .input-group input:focus { border-color: #b8860b; }
        #goldCalculator button { background-color: #b8860b; }
        #goldCalculator .result span { color: #b8860b; }

        /* BMI Calculator */
        #bmiCalculator { border-color: #d1e7dd; }
        #bmiCalculator h1 { color: #28a745; }
        #bmiCalculator .input-group input:focus { border-color: #28a745; }
        #bmiCalculator button { background-color: #28a745; }
        #bmiCalculator .result span { color: #28a745; }

        /* Date Converter */
        #dateConverter { border-color: #cce5ff; }
        #dateConverter h1 { color: #007bff; }
        #dateConverter .input-group input:focus,
        #dateConverter .input-group select:focus { border-color: #007bff; }
        #dateConverter button { background-color: #007bff; }
        #dateConverter .result span { color: #007bff; }

        /* Fortune Teller */
        #fortuneTeller { border-color: #ffe0b3; /* Light orange/peach */ }
        #fortuneTeller h1 { color: #d68910; /* Darker orange/gold */ }
        #fortuneTeller .input-group input:focus,
        #fortuneTeller .input-group select:focus { border-color: #d68910; }
        #fortuneTeller button { background-color: #d68910; }
        #fortuneTeller .result span { color: #d68910; }

        /* Media Queries for Responsiveness */
        @media (max-width: 600px) {
            .navbar {
                flex-direction: column;
                padding: 8px;
            }
            .nav-button {
                margin: 4px 0;
                max-width: none;
                font-size: 0.8em;
                padding: 6px 10px;
            }
            .app-container {
                padding: 18px;
                max-width: 340px;
            }
            .input-group input[type="number"],
            .input-group input[type="text"],
            .input-group select {
                width: calc(100% - 25px);
                padding: 7px 7px 7px 25px;
            }
            .input-group .icon {
                left: 6px;
                font-size: 0.9em;
                transform: translateY(calc(-50% + 7px));
            }
            .input-group select {
                padding-left: 6px;
            }
            .fortune-text {
                font-size: 0.95em;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <button class="nav-button active" onclick="showSection('goldCalculator', this)"><i class="fas fa-gem"></i> قیمت طلا</button>
        <button class="nav-button" onclick="showSection('bmiCalculator', this)"><i class="fas fa-calculator"></i> شاخص وزن</button>
        <button class="nav-button" onclick="showSection('dateConverter', this)"><i class="fas fa-calendar-alt"></i> تبدیل تاریخ</button>
        <button class="nav-button" onclick="showSection('fortuneTeller', this)"><i class="fas fa-hand-sparkles"></i> فال</button>
    </div>

    <div id="goldCalculator" class="app-container">
        <h1><i class="fas fa-gem" style="margin-left: 10px;"></i>محاسبه‌گر هوشمند طلا</h1>
        
        <div class="input-group">
            <label for="goldPriceToman">قیمت روز طلا (تومان در گرم):</label>
            <input type="number" id="goldPriceToman" placeholder="مثال: 3,200,000" min="0">
            <i class="fas fa-coins icon"></i>
        </div>

        <div class="input-group">
            <label for="usdExchangeRate">نرخ برابری دلار به تومان:</label>
            <input type="number" id="usdExchangeRate" placeholder="مثال: 60000" min="1000">
            <i class="fas fa-dollar-sign icon"></i>
            <small>نرخ هر دلار چند تومان است.</small>
        </div>

        <div class="input-group">
            <label>وزن طلا:</label>
            <div class="weight-inputs">
                <div class="input-group">
                    <input type="number" id="goldWeightGram" placeholder="گرم" min="0" step="any">
                    <i class="fas fa-weight-hanging icon"></i>
                </div>
                <div class="input-group">
                    <input type="number" id="goldWeightSoot" placeholder="سوت (تا 999)" min="0" max="999" step="any">
                    <i class="fas fa-balance-scale icon"></i>
                </div>
            </div>
            <small>هر گرم ۱۰۰۰ سوت است. می‌توانید فقط گرم یا سوت را وارد کنید.</small>
        </div>
        
        <div class="input-group">
            <label for="wagePercent">درصد اجرت کار (اختیاری):</label>
            <input type="number" id="wagePercent" placeholder="مثال: 20 (فقط عدد)" min="0" max="100">
            <i class="fas fa-percent icon"></i>
            <small>اگر اجرت ندارد، این فیلد را خالی بگذارید یا ۰ وارد کنید.</small>
        </div>
        
        <button onclick="calculateGoldPrice()">محاسبه قیمت</button>
        
        <div class="result" id="goldResultDiv">
            <div><span>قیمت نهایی:</span> <span id="finalPriceToman"></span> تومان</div>
            <div><span>قیمت نهایی:</span> <span id="finalPriceDollar"></span> دلار</div>
        </div>
    </div>

    <div id="bmiCalculator" class="app-container">
        <h1><i class="fas fa-calculator" style="margin-left: 10px;"></i>محاسبه شاخص توده بدنی (BMI)</h1>
        
        <div class="input-group">
            <label for="weight">وزن (کیلوگرم):</label>
            <input type="number" id="weight" placeholder="مثال: 70" min="1" step="any">
            <i class="fas fa-weight icon"></i>
        </div>
        
        <div class="input-group">
            <label for="height">قد (متر):</label>
            <input type="number" id="height" placeholder="مثال: 1.75" min="0.1" step="0.01">
            <i class="fas fa-ruler-vertical icon"></i>
            <small>مثال: ۱۷۵ سانتی‌متر را ۱.۷۵ متر وارد کنید.</small>
        </div>
        
        <button onclick="calculateBMI()">محاسبه BMI</button>
        
        <div class="result" id="bmiResultDiv">
            <div><span>شاخص BMI شما:</span> <span id="bmiValue"></span></div>
            <div><span>وضعیت:</span> <span id="bmiStatus"></span></div>
        </div>
    </div>

    <div id="dateConverter" class="app-container">
        <h1><i class="fas fa-calendar-alt" style="margin-left: 10px;"></i>تبدیل تاریخ</h1>
        
        <div class="input-group">
            <label>تاریخ میلادی:</label>
            <div class="date-inputs">
                <div class="input-group">
                    <select id="gregorianYear"></select>
                    <i class="fas fa-calendar-day icon"></i>
                </div>
                <div class="input-group">
                    <select id="gregorianMonth"></select>
                </div>
                <div class="input-group">
                    <select id="gregorianDay"></select>
                </div>
            </div>
        </div>
        
        <button onclick="convertGregorianToSolar()">تبدیل میلادی به شمسی</button>

        <hr style="margin: 30px 0; border-top: 1px dashed #eee;">

        <div class="input-group">
            <label>تاریخ شمسی:</label>
            <div class="date-inputs">
                <div class="input-group">
                    <select id="solarYear"></select>
                    <i class="fas fa-calendar-day icon"></i>
                </div>
                <div class="input-group">
                    <select id="solarMonth"></select>
                </div>
                <div class="input-group">
                    <select id="solarDay"></select>
                </div>
            </div>
        </div>
        
        <button onclick="convertSolarToGregorian()">تبدیل شمسی به میلادی</button>
        
        <div class="result" id="dateResultDiv">
            <div><span>تاریخ تبدیل شده:</span> <span id="convertedDate"></span></div>
        </div>
    </div>

    <div id="fortuneTeller" class="app-container">
        <h1><i class="fas fa-hand-sparkles" style="margin-left: 10px;"></i>فال حافظ</h1>

        <div class="input-group">
            <label for="userAge">سن شما:</label>
            <input type="number" id="userAge" placeholder="مثال: 30" min="1" max="120">
            <i class="fas fa-user icon"></i>
        </div>

        <div class="input-group">
            <label for="maritalStatus">وضعیت تاهل:</label>
            <select id="maritalStatus">
                <option value="">انتخاب کنید</option>
                <option value="مجرد">مجرد</option>
                <option value="متاهل">متاهل</option>
                <option value="طلاق گرفته">طلاق گرفته</option>
                <option value="همسر از دست داده">همسر از دست داده</option>
            </select>
            <i class="fas fa-ring icon"></i>
        </div>

        <div class="input-group">
            <label for="birthMonth">ماه تولد:</label>
            <select id="birthMonth"></select>
            <i class="fas fa-calendar-star icon"></i>
        </div>

        <button onclick="generateFortune()">بگیر فال حافظ!</button>

        <div class="result" id="fortuneResultDiv">
            <div class="fortune-text" id="fortuneText"></div>
        </div>
    </div>


    <script src="https://unpkg.com/persian-date@1.1.0/dist/persian-date.min.js"></script>
    
    <script>
        // --- Navigation Logic ---
        function showSection(sectionId, clickedButton) {
            document.querySelectorAll('.app-container').forEach(section => {
                section.style.display = 'none';
            });
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(sectionId).style.display = 'block';
            clickedButton.classList.add('active');

            // Reset results when switching sections
            document.querySelectorAll('.result').forEach(resultDiv => {
                resultDiv.style.display = 'none';
            });

            // If switching to date converter, ensure dropdowns are populated
            if (sectionId === 'dateConverter') {
                initializeDatePickers();
            } else if (sectionId === 'fortuneTeller') {
                populateFortuneMonths();
            }
        }

        // --- Gold Calculator Logic ---
        function calculateGoldPrice() {
            const goldPricePerGramToman = parseFloat(document.getElementById('goldPriceToman').value);
            const usdExchangeRate = parseFloat(document.getElementById('usdExchangeRate').value);
            const goldWeightGram = parseFloat(document.getElementById('goldWeightGram').value || 0);
            const goldWeightSoot = parseFloat(document.getElementById('goldWeightSoot').value || 0);
            const wagePercent = parseFloat(document.getElementById('wagePercent').value || 0);

            if (isNaN(goldPricePerGramToman) || goldPricePerGramToman <= 0) {
                alert('لطفاً قیمت روز طلا را به درستی وارد کنید.');
                return;
            }
            if (isNaN(usdExchangeRate) || usdExchangeRate <= 0) {
                alert('لطفاً نرخ برابری دلار را به درستی وارد کنید.');
                return;
            }

            const totalWeightGram = goldWeightGram + (goldWeightSoot / 1000);

            if (totalWeightGram <= 0) {
                 alert('لطفاً وزن طلا را وارد کنید.');
                 return;
            }

            let wageAmountToman = (goldPricePerGramToman * (wagePercent / 100)) * totalWeightGram;
            const profitAmountToman = (goldPricePerGramToman * 0.07) * totalWeightGram;
            const taxAmountToman = (wageAmountToman + profitAmountToman) * 0.10;
            const rawGoldPriceToman = goldPricePerGramToman * totalWeightGram;
            const finalPriceToman = rawGoldPriceToman + wageAmountToman + profitAmountToman + taxAmountToman;
            const finalPriceDollar = finalPriceToman / usdExchangeRate;

            document.getElementById('finalPriceToman').innerText = finalPriceToman.toLocaleString('fa-IR');
            document.getElementById('finalPriceDollar').innerText = finalPriceDollar.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('goldResultDiv').style.display = 'block';
        }

        // --- BMI Calculator Logic ---
        function calculateBMI() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if (isNaN(weight) || weight <= 0) {
                alert('لطفاً وزن را به درستی وارد کنید.');
                return;
            }
            if (isNaN(height) || height <= 0) {
                alert('لطفاً قد را به درستی وارد کنید.');
                return;
            }

            const bmi = weight / (height * height);
            let status = '';

            if (bmi < 18.5) {
                status = 'کم‌وزنی';
            } else if (bmi >= 18.5 && bmi <= 24.9) {
                status = 'وزن نرمال';
            } else if (bmi >= 25 && bmi <= 29.9) {
                status = 'اضافه‌وزن';
            } else if (bmi >= 30 && bmi <= 34.9) {
                status = 'چاقی (درجه ۱)';
            } else if (bmi >= 35 && bmi <= 39.9) {
                status = 'چاقی شدید (درجه ۲)';
            } else {
                status = 'چاقی مفرط (درجه ۳)';
            }

            document.getElementById('bmiValue').innerText = bmi.toLocaleString('fa-IR', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
            document.getElementById('bmiStatus').innerText = status;
            document.getElementById('bmiResultDiv').style.display = 'block';
        }

        // --- Date Converter Logic ---

        const gregMonths = [
            { value: 1, text: 'ژانویه (January)' }, { value: 2, text: 'فوریه (February)' },
            { value: 3, text: 'مارس (March)' }, { value: 4, text: 'آوریل (April)' },
            { value: 5, text: 'مه (May)' }, { value: 6, text: 'ژوئن (June)' },
            { value: 7, text: 'ژوئیه (July)' }, { value: 8, text: 'اوت (August)' },
            { value: 9, text: 'سپتامبر (September)' }, { value: 10, text: 'اکتبر (October)' },
            { value: 11, text: 'نوامبر (November)' }, { value: 12, text: 'دسامبر (December)' }
        ];

        const solarMonths = [
            { value: 1, text: 'فروردین' }, { value: 2, text: 'اردیبهشت' },
            { value: 3, text: 'خرداد' }, { value: 4, text: 'تیر' },
            { value: 5, text: 'مرداد' }, { value: 6, text: 'شهریور' },
            { value: 7, text: 'مهر' }, { value: 8, text: 'آبان' },
            { value: 9, text: 'آذر' }, { value: 10, text: 'دی' },
            { value: 11, text: 'بهمن' }, { value: 12, text: 'اسفند' }
        ];

        function populateYears(selectId, startYear, endYear, isPersian) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">سال</option>';
            for (let year = startYear; year >= endYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.innerText = isPersian ? new persianDate().formatPersian({ number: year }) : year;
                select.appendChild(option);
            }
        }

        function populateMonths(selectId, monthsArray) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">ماه</option>';
            monthsArray.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.innerText = month.text;
                select.appendChild(option);
            });
        }

        function populateDays(selectId, maxDays) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">روز</option>';
            for (let day = 1; day <= maxDays; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.innerText = day;
                select.appendChild(option);
            }
        }

        function initializeDatePickers() {
            const currentGregYear = new Date().getFullYear();
            const currentSolarYear = new persianDate().year();

            // Populate Gregorian years
            populateYears('gregorianYear', currentGregYear, currentGregYear - 100, false);
            populateMonths('gregorianMonth', gregMonths);
            updateGregorianDays(); // Ensure correct days for default month/year

            // Populate Solar years
            populateYears('solarYear', currentSolarYear, currentSolarYear - 100, true);
            populateMonths('solarMonth', solarMonths);
            updateSolarDays(); // Ensure correct days for default month/year

            // Add event listeners for Gregorian date changes
            document.getElementById('gregorianYear').onchange = () => { updateGregorianDays(); convertGregorianToSolar(); };
            document.getElementById('gregorianMonth').onchange = () => { updateGregorianDays(); convertGregorianToSolar(); };
            document.getElementById('gregorianDay').onchange = convertGregorianToSolar;

            // Add event listeners for Solar date changes
            document.getElementById('solarYear').onchange = () => { updateSolarDays(); convertSolarToGregorian(); };
            document.getElementById('solarMonth').onchange = () => { updateSolarDays(); convertSolarToGregorian(); };
            document.getElementById('solarDay').onchange = convertSolarToGregorian;

            // Clear date results when changing values
            document.querySelectorAll('#gregorianYear, #gregorianMonth, #gregorianDay, #solarYear, #solarMonth, #solarDay').forEach(select => {
                select.addEventListener('change', () => {
                    document.getElementById('dateResultDiv').style.display = 'none';
                });
            });
        }

        function updateGregorianDays() {
            const year = parseInt(document.getElementById('gregorianYear').value);
            const month = parseInt(document.getElementById('gregorianMonth').value);
            
            if (year && month) {
                const date = new Date(year, month - 1, 1);
                const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
                populateDays('gregorianDay', lastDay);
            } else {
                populateDays('gregorianDay', 31);
            }
        }

        function updateSolarDays() {
            const year = parseInt(document.getElementById('solarYear').value);
            const month = parseInt(document.getElementById('solarMonth').value);
            
            if (year && month) {
                let maxDays;
                if (month <= 6) { // First 6 months have 31 days
                    maxDays = 31;
                } else if (month <= 11) { // Next 5 months have 30 days
                    maxDays = 30;
                } else { // Esfand (12th month)
                    // persianDate library correctly handles leap years for Persian calendar
                    const pDateForLeapCheck = new persianDate([year, 1, 1]); 
                    maxDays = pDateForLeapCheck.isLeapYear() ? 30 : 29;
                }
                populateDays('solarDay', maxDays);
            } else {
                populateDays('solarDay', 31);
            }
        }

        function convertGregorianToSolar() {
            const year = parseInt(document.getElementById('gregorianYear').value);
            const month = parseInt(document.getElementById('gregorianMonth').value);
            const day = parseInt(document.getElementById('gregorianDay').value);

            if (isNaN(year) || isNaN(month) || isNaN(day)) {
                document.getElementById('dateResultDiv').style.display = 'none';
                return;
            }
            
            try {
                // persianDate expects Gregorian date directly for conversion
                const pDate = new persianDate([year, month, day]);
                document.getElementById('convertedDate').innerText = pDate.format('YYYY/MM/DD');
                document.getElementById('dateResultDiv').style.display = 'block';

                // Clear Solar date inputs to avoid confusion
                document.getElementById('solarYear').value = '';
                document.getElementById('solarMonth').value = '';
                document.getElementById('solarDay').value = '';

            } catch (error) {
                alert('مشکلی در تبدیل تاریخ میلادی رخ داد. لطفاً تاریخ را بررسی کنید.');
                console.error(error);
            }
        }

        function convertSolarToGregorian() {
            const year = parseInt(document.getElementById('solarYear').value);
            const month = parseInt(document.getElementById('solarMonth').value);
            const day = parseInt(document.getElementById('solarDay').value);

            if (isNaN(year) || isNaN(month) || isNaN(day)) {
                document.getElementById('dateResultDiv').style.display = 'none';
                return;
            }
            
            try {
                // persianDate constructor directly accepts Persian date components
                const pDate = new persianDate([year, month, day]);
                const gregorianDate = pDate.toCalendar('gregorian');
                const gYear = gregorianDate.year();
                const gMonth = (gregorianDate.month() + 1).toString().padStart(2, '0');
                const gDay = gregorianDate.date().toString().padStart(2, '0');
                
                document.getElementById('convertedDate').innerText = `${gYear}-${gMonth}-${gDay}`;
                document.getElementById('dateResultDiv').style.display = 'block';

                // Clear Gregorian date inputs to avoid confusion
                document.getElementById('gregorianYear').value = '';
                document.getElementById('gregorianMonth').value = '';
                document.getElementById('gregorianDay').value = '';

            } catch (error) {
                alert('مشکلی در تبدیل تاریخ شمسی رخ داد. لطفاً تاریخ را بررسی کنید.');
                console.error(error);
            }
        }

        // --- Fortune Teller Logic ---

        const birthMonths = [
            { value: 'فروردین', text: 'فروردین' }, { value: 'اردیبهشت', text: 'اردیبهشت' },
            { value: 'خرداد', text: 'خرداد' }, { value: 'تیر', text: 'تیر' },
            { value: 'مرداد', text: 'مرداد' }, { value: 'شهریور', text: 'شهریور' },
            { value: 'مهر', text: 'مهر' }, { value: 'آبان', text: 'آبان' },
            { value: 'آذر', text: 'آذر' }, { value: 'دی', text: 'دی' },
            { value: 'بهمن', text: 'بهمن' }, { value: 'اسفند', text: 'اسفند' }
        ];

        const fortunes = {
            'فروردین': [
                "در مسیر زندگی شما تغییرات مثبتی در راه است. با آغوش باز پذیرای آن‌ها باشید و از فرصت‌های جدید استفاده کنید. شجاعت شما ستودنی است.",
                "نزدیک‌ترین افراد به شما، حامیان واقعی‌تان هستند. به آن‌ها اعتماد کنید و از مشورت‌هایشان بهره ببرید. روزهای روشن در پیش دارید.",
                "ممکن است با چالش کوچکی روبرو شوید، اما قدرت درونی شما برای غلبه بر آن کافیست. به خودتان ایمان داشته باشید و پافشاری کنید.",
                "فکر جدیدی که در سر دارید، پتانسیل زیادی برای موفقیت دارد. آن را جدی بگیرید و با برنامه‌ریزی پیش بروید. خوشبختی در دستان شماست.",
                "لحظات آرامی در انتظار شماست. از این فرصت برای خوداندیشی و برنامه‌ریزی برای آینده استفاده کنید. قلب شما راهنماست."
            ],
            'اردیبهشت': [
                "صبر و پشتکار شما نتیجه خواهد داد. هدف‌هایی که در نظر دارید، کم‌کم به بار می‌نشینند. به تلاش‌هایتان ادامه دهید.",
                "در مسائل مالی، هوشیار باشید. فرصت‌های خوبی برای بهبود وضعیت اقتصادی‌تان پیش می‌آید. از آن‌ها غافل نشوید.",
                "روابط عاطفی شما در مرحله‌ای حساس قرار دارد. با صبوری و درک متقابل می‌توانید آن را تقویت کنید. عشق شما پایدار است.",
                "طبیعت و آرامش آن برای شما شفابخش خواهد بود. لحظاتی را به دور از هیاهو بگذرانید و روحتان را تازه کنید.",
                "انتظار خبری خوش را داشته باشید که زندگی شما را دگرگون می‌کند. آماده پذیرش تغییرات مثبت باشید. شادمانی در راه است."
            ],
            'خرداد': [
                "ذهن شما پر از ایده‌های نو است. این ایده‌ها را به اشتراک بگذارید و از قدرت ارتباطات خود برای پیشرفت استفاده کنید.",
                "درگیری‌های ذهنی کوچک ممکن است شما را آزار دهد. سعی کنید آن‌ها را با منطق حل کنید و آرامش خود را حفظ کنید.",
                "فردی از گذشته ممکن است دوباره وارد زندگی شما شود. با احتیاط عمل کنید و درس‌های گذشته را به خاطر بسپارید.",
                "سفر کوتاهی در پیش دارید که برای شما پر از تجربه و آموختن خواهد بود. از این فرصت نهایت استفاده را ببرید.",
                "توانایی شما در سازگاری با شرایط جدید بی‌نظیر است. از این ویژگی برای رسیدن به اهدافتان استفاده کنید. موفقیت نزدیک است."
            ],
            'تیر': [
                "خانواده و عزیزان شما منبع آرامش و قدرت شما هستند. برای آن‌ها وقت بگذارید و قدردان حضورشان باشید.",
                "مسائل عاطفی برای شما در اولویت قرار می‌گیرد. با صداقت و مهربانی می‌توانید مشکلات را حل کنید و به صلح برسید.",
                "فرصتی برای کسب درآمد بیشتر یا بهبود وضعیت شغلی‌تان پیش می‌آید. آن را از دست ندهید.",
                "احساسات شما قوی هستند. آن‌ها را کنترل کنید تا تصمیمات منطقی‌تری بگیرید. دل شما پاک است.",
                "در روزهای آینده خبری از کسی که مدت‌ها منتظرش بودید، دریافت خواهید کرد. این خبر مسیر زندگی‌تان را تغییر می‌دهد."
            ],
            'مرداد': [
                "شما رهبری ذاتی دارید. از این ویژگی برای هدایت خود و اطرافیانتان به سمت موفقیت استفاده کنید.",
                "در محیط کار یا تحصیل، فرصتی برای درخشش و نشان دادن توانایی‌هایتان پیش می‌آید. آن را غنیمت بشمارید.",
                "مراقب حسادت برخی افراد باشید. با اعتماد به نفس و تمرکز بر اهدافتان، از انرژی‌های منفی دور بمانید.",
                "تفریحات و سرگرمی‌ها برای شما لازم است. کمی استراحت کنید و به روحیه خود اهمیت دهید. شادی حق شماست.",
                "قلب شما به زودی با عشق و هیجان جدیدی روبرو خواهد شد. آماده یک رابطه عمیق و پرشور باشید."
            ],
            'شهریور': [
                "دقت و نظم شما در هر کاری تحسین‌برانگیز است. با همین ویژگی به موفقیت‌های بزرگ دست پیدا می‌کنید.",
                "ممکن است نیاز به بازنگری در برنامه‌های مالی خود داشته باشید. با دقت برنامه‌ریزی کنید و از هزینه‌های غیرضروری بپرهیزید.",
                "سلامتی خود را در اولویت قرار دهید. رژیم غذایی مناسب و ورزش به شما انرژی بیشتری می‌دهد.",
                "در روابط شخصی، به جزئیات توجه کنید. گاهی یک حرکت کوچک، تأثیر بزرگی دارد. مهربانی شما سرمایه است.",
                "یک راز قدیمی ممکن است برملا شود. با آن به درستی برخورد کنید و از قضاوت عجولانه پرهیز کنید."
            ],
            'مهر': [
                "عدالت و توازن برای شما بسیار مهم است. در هر تصمیمی، سعی کنید انصاف را رعایت کنید. آرامش در صلح است.",
                "در روابط عاطفی، به دنبال هماهنگی و درک متقابل باشید. با گفتگو می‌توانید سوءتفاهم‌ها را برطرف کنید.",
                "فرصتی برای همکاری‌های جدید پیش می‌آید. با دقت شرکا را انتخاب کنید. آینده‌ای روشن در انتظار است.",
                "زیبایی‌های اطرافتان را کشف کنید. هنر و طبیعت می‌توانند روحیه شما را تازه کنند. لذت ببرید.",
                "تصمیمی مهم در پیش است که باید با مشورت و سنجیده گرفته شود. عجله نکنید. خرد شما راهنماست."
            ],
            'آبان': [
                "قدرت درونی شما برای مواجهه با مشکلات بی‌نظیر است. از موانع نترسید و با شهامت پیش بروید.",
                "مسائل مالی پیچیده‌ای ممکن است پیش آید. با تحقیق و مشورت با متخصصان می‌توانید بهترین تصمیم را بگیرید.",
                "در روابط شخصی، به عمق احساسات توجه کنید. صداقت و صمیمیت رمز موفقیت شماست. عشق شما پایدار است.",
                "ممکن است وسوسه شوید که رازی را برملا کنید. صبور باشید و عواقب آن را بسنجید. راز نگهدار باشید.",
                "تغییرات ناگهانی ممکن است رخ دهد. با انعطاف‌پذیری می‌توانید خود را با شرایط جدید وفق دهید. پیروزی با شماست."
            ],
            'آذر': [
                "ماجراجویی و کشف چیزهای جدید برای شما حیاتی است. به دنبال فرصت‌های تازه باشید و از منطقه امن خود خارج شوید.",
                "در یادگیری و گسترش دانش خود سرمایه‌گذاری کنید. این راهی برای پیشرفت و موفقیت‌های آتی شماست.",
                "برخی سوءتفاهم‌ها با دوستان ممکن است پیش آید. با صراحت و مهربانی می‌توانید آن‌ها را حل کنید.",
                "سفر طولانی‌مدتی در پیش دارید که برای شما تجربه‌های ارزشمندی به ارمغان می‌آورد. آماده باشید.",
                "آرمان‌گرایی شما ستودنی است. با هدف‌گذاری واقع‌بینانه می‌توانید به آرزوهایتان دست پیدا کنید. افق‌های شما روشن است."
            ],
            'دی': [
                "پشتکار و تعهد شما به اهدافتان، ستودنی است. با همین رویکرد به قله‌های موفقیت می‌رسید.",
                "در مسائل شغلی، جدی باشید و مسئولیت‌پذیری خود را نشان دهید. پاداش تلاش‌هایتان را دریافت خواهید کرد.",
                "ممکن است احساس تنهایی کنید. با خانواده و دوستانتان وقت بگذرانید و از حمایت آن‌ها بهره‌مند شوید.",
                "برنامه‌ریزی دقیق برای آینده برای شما ضروری است. قدم به قدم پیش بروید و از مسیر لذت ببرید.",
                "در مواجهه با سختی‌ها، قوی باشید. قدرت درونی شما بیشتر از آن چیزی است که فکر می‌کنید. پیروزی نزدیک است."
            ],
            'بهمن': [
                "ایده‌های نو و خلاقانه شما مورد تحسین قرار خواهد گرفت. از به اشتراک گذاشتن آن‌ها نترسید.",
                "ممکن است با افرادی آشنا شوید که دیدگاه‌های شما را تغییر دهند. از این تجربیات استفاده کنید.",
                "در مسائل اجتماعی فعال باشید. کمک به دیگران به شما احساس رضایت می‌بخشد. قلب شما بزرگ است.",
                "آزادی و استقلال برای شما اهمیت زیادی دارد. برای حفظ آن تلاش کنید، اما مسئولیت‌پذیری را فراموش نکنید.",
                "یک آرزوی دیرینه به زودی محقق می‌شود. شکرگزار باشید و از لحظات شاد زندگی لذت ببرید."
            ],
            'اسفند': [
                "احساسات شما عمیق و قوی هستند. آن‌ها را درک کنید و به خودتان اجازه دهید که آن‌ها را تجربه کنید.",
                "خلاقیت شما در اوج است. از این فرصت برای خلق آثار هنری یا حل مشکلات به شیوه‌ای نو استفاده کنید.",
                "ممکن است احساس کنید در دنیای خیالی خود غرق شده‌اید. کمی به واقعیت برگردید و برنامه‌ریزی کنید.",
                "در روابط عاطفی، همدلی و فداکاری شما ستودنی است. اما مراقب باشید که از خودتان غافل نشوید.",
                "پیام‌های مهمی از ناخودآگاه خود دریافت خواهید کرد. به رویاهایتان توجه کنید و از شهودتان پیروی کنید. موفقیت در راه است."
            ]
        };

        function populateFortuneMonths() {
            const select = document.getElementById('birthMonth');
            select.innerHTML = '<option value="">ماه تولد را انتخاب کنید</option>';
            solarMonths.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.innerText = month.text;
                select.appendChild(option);
            });
        }

        function generateFortune() {
            const age = document.getElementById('userAge').value;
            const maritalStatus = document.getElementById('maritalStatus').value;
            const birthMonth = document.getElementById('birthMonth').value;

            if (!age || !maritalStatus || !birthMonth) {
                alert('لطفاً تمام اطلاعات مورد نیاز برای گرفتن فال را تکمیل کنید.');
                return;
            }

            const monthFortunes = fortunes[birthMonth];
            if (monthFortunes && monthFortunes.length > 0) {
                const randomIndex = Math.floor(Math.random() * monthFortunes.length);
                document.getElementById('fortuneText').innerText = monthFortunes[randomIndex];
                document.getElementById('fortuneResultDiv').style.display = 'block';
            } else {
                document.getElementById('fortuneText').innerText = 'فالی برای این ماه تولد یافت نشد. لطفاً ماه دیگری را انتخاب کنید.';
                document.getElementById('fortuneResultDiv').style.display = 'block';
            }
        }


        // Initial display: show gold calculator by default and initialize relevant dropdowns
        document.addEventListener('DOMContentLoaded', (event) => {
            showSection('goldCalculator', document.querySelector('.nav-button.active'));
        });
    </script>
</body>
</html>
