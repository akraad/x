<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ابزارک‌های هوشمند</title>
    <link href="https://cdn.fontcdn.ir/Font/Persian/Shabnam/Shabnam.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Shabnam', 'Vazirmatn', sans-serif;
            background-color: #1a1a1a; /* Dark background */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #f0f0f0; /* Light text */
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Theme Toggle Button --- */
        .icon-button {
            background: none;
            border: none;
            color: #f0f0f0;
            font-size: 1.4em;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: fixed;
            top: 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .icon-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #FFD700; /* Gold on hover */
        }
        #themeToggle { right: 20px; }


        /* Light Theme Specific Styles */
        body.light-theme {
            background-image: linear-gradient(135deg, #e0e0e0, #f0f0f0, #e8e8e8); /* Gray gradient */
            color: #333; /* Dark text */
        }
        body.light-theme .navbar,
        body.light-theme .app-container,
        body.light-theme .modal-content {
            background-color: #ffffff;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }
        body.light-theme .nav-button {
            background-color: #f8f9fa;
            color: #555;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid #dee2e6;
        }
        body.light-theme .nav-button:hover {
            background-color: #e2e6ea;
            color: #333;
        }
        body.light-theme .nav-button.active {
            background-color: #e9ecef;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), inset 0 0 10px rgba(0, 0, 0, 0.05);
            color: #333;
        }
        body.light-theme .nav-button i {
            color: #888;
        }
        body.light-theme .nav-button.active i {
            color: #333;
        }
        body.light-theme h1,
        body.light-theme .input-group label,
        body.light-theme .result {
            color: #333;
        }
        body.light-theme .modal-content h2,
        body.light-theme .modal-content p {
            color: #333;
        }
        body.light-theme .input-group input,
        body.light-theme .input-group select {
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            color: #333;
        }
        body.light-theme .input-group input::placeholder {
            color: #777;
        }
        body.light-theme .input-group .icon {
            color: #888;
        }
        body.light-theme .input-group small {
            color: #666;
        }
        body.light-theme .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
        }
        body.light-theme .personality-text {
            background-color: #f8f9fa;
            border: 1px dashed #ced4da;
            color: #333;
        }
        body.light-theme .personality-text h2 {
            color: #CC9900; /* Darker Gold for Light theme */
        }
        body.light-theme .personality-text h3 {
            color: #CC6600; /* Darker Orange for Light theme */
        }
        body.light-theme .personality-text li {
            color: #444;
        }
        body.light-theme .positive-point {
            color: #1e7e34; /* Darker Green */
        }
        body.light-theme .negative-point {
            color: #bd2130; /* Darker Red */
        }
        body.light-theme .comparison-section {
            border-top-color: #dee2e6;
        }
        body.light-theme .tab-button {
            background-color: #e9ecef;
            border: 15px solid #ced4da;
            color: #555;
        }
        body.light-theme .tab-button.active {
            background-color: #6a006a; /* Darker Purple for contrast */
            border-color: #6a006a;
            color: white;
        }
        body.light-theme .tab-button i {
            color: #888;
        }
        body.light-theme .tab-button.active i {
            color: #333;
        }
        body.light-theme .toggle-switch {
            background-color: #e9ecef;
            border: 1px solid #ced4da;
        }
        body.light-theme .toggle-switch span {
            color: #333;
        }
        body.light-theme .slider {
            background-color: #bbb;
        }
        body.light-theme input:checked + .slider {
            background-color: #6a006a; /* Darker Purple */
        }
        body.light-theme input:focus + .slider {
            box-shadow: 0 0 1px #6a006a;
        }
        body.light-theme .activity-table th,
        body.light-theme .activity-table td {
            border: 1px solid #ced4da;
            color: #333;
        }
        body.light-theme .activity-table th {
            background-color: #e2e6ea;
            color: #CC9900; /* Darker Gold */
        }
        body.light-theme .activity-table td {
            background-color: #f8f9fa;
        }
        body.light-theme .activity-table td:first-child {
            color: #CC6600; /* Darker Orange */
        }
        body.light-theme .total-cost-row {
            background-color: #e9ecef;
            color: #1e7e34 !important; /* Darker Green */
        }
        body.light-theme .total-cost-row td {
            color: #1e7e34 !important; /* Darker Green */
        }
        body.light-theme .suggestion-section h3 {
            color: #CC6600; /* Darker Orange */
        }
        body.light-theme .suggestion-section .highlight {
            color: #1e7e34; /* Darker Green */
        }
        body.light-theme .comparison-result h3,
        body.light-theme .food-comparison-list li::before {
            color: #CC9900;
        }
        body.light-theme .comparison-result p,
        body.light-theme .food-comparison-list li {
            color: #444;
        }
        body.light-theme .food-comparison-list li::before {
            color: #1e7e34;
        }
        body.light-theme .modal-content .input-group input,
        body.light-theme .modal-content .input-group select {
            background-color: #f0f2f5;
        }
        body.light-theme #activityOptions {
            background-color: #f0f2f5;
            border: 1px solid #ced4da;
        }
        body.light-theme .activity-item-option {
            background-color: #ffffff !important;
            border: 1px solid #e0e0e0 !important;
        }
        body.light-theme .activity-item-option label {
            color: #333 !important;
        }
        body.light-theme .activity-item-option input[type="number"] {
            background-color: #e9ecef !important;
            color: #333 !important;
        }
        /* New styles for +/- buttons */
        .input-with-buttons {
            display: flex;
            align-items: center;
            gap: 5px; /* Space between input and buttons */
        }
        .input-with-buttons input[type="number"] {
            flex-grow: 1;
            width: auto; /* Allow input to grow */
            text-align: center;
        }
        .input-with-buttons button {
            width: 35px; /* Fixed width for buttons */
            height: 35px;
            padding: 0;
            margin: 0;
            font-size: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%; /* Make them round */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            background-color: #555;
            color: white;
            transition: background-color 0.2s ease;
        }
        .input-with-buttons button:hover {
            background-color: #777;
        }
        body.light-theme .input-with-buttons button {
            background-color: #ccc;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        body.light-theme .input-with-buttons button:hover {
            background-color: #bbb;
        }


        /* --- Dynamic Navbar Styles --- */
        .navbar {
            display: flex;
            justify-content: center;
            background-color: #2a2a2a; /* Slightly lighter dark */
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 950px;
            flex-wrap: wrap;
            gap: 10px;
            border: 1px solid #3a3a3a;
        }
        .nav-button {
            background-color: #3a3a3a;
            color: #e0e0e0;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-grow: 1;
            min-width: 130px;
            max-width: 190px;
            font-weight: 600;
            display: flex;
            flex-direction: column; /* Stack icon and text */
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent; /* Default transparent border */
        }
        .nav-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px; /* Border thickness */
            background-color: transparent;
            transition: background-color 0.3s ease;
        }

        /* Specific colors for each button's border and hover/active states */
        .nav-button[data-color="gold"]:before { background-color: #FFD700; } /* Gold */
        .nav-button[data-color="green"]:before { background-color: #28a745; } /* Green */
        .nav-button[data-color="orange"]:before { background-color: #FFA500; } /* Orange */
        .nav-button[data-color="purple"]:before { background-color: #800080; } /* Purple */
        .nav-button[data-color="blue"]:before { background-color: #1e90ff; } /* Blue */
        .nav-button[data-color="red"]:before { background-color: #dc3545; } /* Red */

        .nav-button:hover {
            background-color: #4a4a4a;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            color: #ffffff;
        }
        .nav-button.active {
            background-color: #5a5a5a;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
            color: #ffffff;
            border-color: var(--button-color); /* Use CSS variable for active border */
        }
        .nav-button i {
            margin-bottom: 8px; /* Space between icon and text */
            margin-left: 0; /* Remove left margin for stacking */
            font-size: 1.3em;
            color: #bbb;
        }
        .nav-button.active i {
            color: #fff;
        }

        /* --- Common App Container Styles --- */
        .app-container {
            background-color: #2a2a2a; /* Darker grey background for containers */
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            padding: 30px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            border: 1px solid #3a3a3a;
            display: none; /* Initially hidden */
            transition: all 0.4s ease-in-out;
        }
        .app-container h1 {
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        .input-group {
            margin-bottom: 20px;
            text-align: right;
            position: relative;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95em;
            color: #e0e0e0;
        }
        .input-group input[type="number"],
        .input-group input[type="text"],
        .input-group select {
            width: calc(100% - 40px);
            padding: 12px 15px 12px 35px;
            border: 1px solid #555;
            border-radius: 8px;
            font-size: 1em;
            background-color: #3a3a3a;
            color: #f0f0f0;
            direction: ltr; /* Default for inputs */
            text-align: right;
            transition: border-color 0.3s, box-shadow 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-left: 45px;
        }

        .input-group select {
            width: calc(100% - 15px);
            padding-left: 15px; /* Adjust padding for select */
            direction: rtl; /* For Persian text in select */
            cursor: pointer;
        }
        .input-group select option {
            background-color: #3a3a3a; /* Darker background for options */
            color: #f0f0f0;
            padding: 8px;
        }

        .input-group input[type="number"]:focus,
        .input-group input[type="text"]:focus,
        .input-group select:focus {
            outline: none;
            border-color: #1e90ff; /* Default focus blue */
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.3);
        }
        .input-group .icon {
            position: absolute;
            left: 12px;
            top: 50%; /* Center vertically with label and input */
            transform: translateY(calc(-50% + 12px)); /* Adjust for label height */
            color: #aaa;
            font-size: 1.1em;
            pointer-events: none; /* Make icon not clickable */
        }
        .input-group small {
            display: block;
            margin-top: 5px;
            color: #bbb;
            font-size: 0.8em;
            text-align: right;
        }
        .flex-inputs {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        .flex-inputs .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        .flex-inputs .input-group label {
            white-space: nowrap;
        }
        .app-container button {
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.05em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            font-weight: 600;
            margin-top: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        }
        .app-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5);
        }
        .result {
            margin-top: 30px;
            background-color: #3a3a3a;
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            font-size: 1.1em;
            color: #f0f0f0;
            font-weight: 600;
            display: none;
            text-align: right;
            line-height: 1.8;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.4);
        }
        .result div {
            margin-bottom: 8px;
        }
        .result span {
            font-size: 1em;
            margin-right: 8px;
            font-weight: 700;
        }
        .result .small-text {
            font-size: 0.75em;
            color: #bbb;
            display: block;
            margin-top: 15px;
            font-weight: normal;
        }
        .personality-text {
            font-size: 1.05em;
            font-weight: normal;
            margin-top: 20px;
            text-align: justify;
            background-color: #3a3a3a;
            border: 1px dashed #555;
            padding: 20px;
            border-radius: 10px;
            color: #e0e0e0;
            line-height: 1.7;
        }
        .personality-text h2 {
            color: #FFD700; /* Gold for titles in personality */
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        .personality-text h3 {
            color: #ffa500; /* Orange for subheadings */
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
            text-align: right;
        }
        .personality-text ul {
            list-style-type: disc;
            padding-right: 25px;
            margin-bottom: 15px;
        }
        .personality-text li {
            margin-bottom: 5px;
            color: #e0e0e0;
        }
        .positive-point {
            color: #8aff8a; /* Lighter green */
            font-weight: 600;
        }
        .negative-point {
            color: #ff8a8a; /* Lighter red */
            font-weight: 600;
        }
        .comparison-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #555;
            text-align: right;
        }
        .comparison-section label {
            font-size: 0.95em;
            color: #e0e0e0;
            display: block;
            margin-bottom: 12px;
        }
        .comparison-section select {
            width: calc(100% - 15px);
            padding: 10px 10px 10px 10px;
            border: 1px solid #555;
            border-radius: 8px;
            font-size: 0.95em;
            direction: rtl;
            background-color: #3a3a3a;
            color: #f0f0f0;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .comparison-section button {
            margin-top: 15px;
            background-color: #1e90ff; /* Blue for comparison button */
        }
        .comparison-result {
            margin-top: 20px;
            background-color: #3a3a3a;
            border: 1px solid #555;
            border-radius: 10px;
            padding: 20px;
            text-align: right;
        }
        .comparison-result h3 {
            font-size: 1.2em;
            color: #FFD700; /* Gold */
            margin-bottom: 15px;
            text-align: center;
        }
        .comparison-result p {
            font-size: 0.95em;
            line-height: 1.7;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        /* --- Loan/Deposit Calculator Specific Styles --- */
        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
        }
        .tab-button {
            background-color: #3a3a3a;
            border: 1px solid #555;
            padding: 10px 18px;
            cursor: pointer;
            font-size: 0.95em;
            border-radius: 8px 8px 0 0;
            margin: 0 3px;
            transition: all 0.2s ease;
            color: #e0e0e0;
        }
        .tab-button.active {
            background-color: #800080; /* Purple */
            color: white;
            border-color: #800080;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        .loan-deposit-content {
            display: none;
        }
        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: #3a3a3a;
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #555;
        }
        .toggle-switch span {
            font-size: 0.95em;
            color: #e0e0e0;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 25px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #666;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 25px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #800080; /* Purple */
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #800080;
        }
        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* --- Specific Form Colors --- */

        /* Gold Calculator */
        #goldCalculator h1 { color: #FFD700; }
        #goldCalculator .input-group input:focus { border-color: #FFD700; box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.3); }
        #goldCalculator button { background-color: #FFD700; color: #333; }
        #goldCalculator button:hover { background-color: #e6c200; }
        #goldCalculator .result span { color: #FFD700; }

        /* BMI Calculator */
        #bmiCalculator h1 { color: #28a745; }
        #bmiCalculator .input-group input:focus { border-color: #28a745; box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.3); }
        #bmiCalculator button { background-color: #28a745; }
        #bmiCalculator button:hover { background-color: #218838; }
        #bmiCalculator .result span { color: #28a745; }

        /* Personality Test */
        #personalityTest h1 { color: #FFA500; }
        #personalityTest .input-group input:focus,
        #personalityTest .input-group select:focus { border-color: #FFA500; box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.3); }
        #personalityTest button { background-color: #FFA500; }
        #personalityTest button:hover { background-color: #e69500; }
        #personalityTest .result span { color: #FFA500; }
        #personalityTest .comparison-section button { background-color: #1e90ff; }
        #personalityTest .comparison-section button:hover { background-color: #1a7ae0; }

        /* Loan/Deposit Calculator */
        #loanDepositCalculator h1 { color: #800080; } /* Purple */
        #loanDepositCalculator .input-group input:focus,
        #loanDepositCalculator .input-group select:focus { border-color: #800080; box-shadow: 0 0 0 3px rgba(128, 0, 128, 0.3); }
        #loanDepositCalculator button { background-color: #800080; }
        #loanDepositCalculator button:hover { background-color: #6a006a; }
        #loanDepositCalculator .result span { color: #800080; }

        /* Currency Converter */
        #currencyConverter h1 { color: #1e90ff; } /* Dodger Blue */
        #currencyConverter .input-group input:focus,
        #currencyConverter .input-group select:focus { border-color: #1e90ff; box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.3); }
        #currencyConverter button { background-color: #1e90ff; }
        #currencyConverter button:hover { background-color: #1a7ae0; }
        #currencyConverter .result span { color: #1e90ff; }

        /* Hypothetical Services Calculator */
        #hypotheticalServicesCalculator h1 { color: #dc3545; } /* Red */
        #hypotheticalServicesCalculator .input-group input:focus { border-color: #dc3545; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.3); }
        #hypotheticalServicesCalculator button { background-color: #dc3545; }
        #hypotheticalServicesCalculator button:hover { background-color: #c82333; }
        #hypotheticalServicesCalculator .result span { color: #dc3545; }
        #hypotheticalServicesCalculator .category-item {
            font-weight: bold;
            color: #FFD700; /* Gold for category names */
            margin-bottom: 8px;
        }
        #hypotheticalServicesCalculator .category-range {
            font-size: 0.85em;
            color: #aaa;
            margin-right: 5px;
            font-weight: normal;
        }
        #hypotheticalServicesCalculator ul {
            text-align: right;
            list-style-type: none; /* No default bullet */
            padding-right: 0;
            margin-top: 15px;
            color: #f0f0f0;
            font-size: 0.95em;
        }
        #hypotheticalServicesCalculator ul li {
            margin-bottom: 10px;
            position: relative;
            padding-right: 20px; /* Space for custom bullet */
        }
        #hypotheticalServicesCalculator ul li::before {
            content: "•"; /* Custom bullet point */
            color: #FFD700; /* Gold bullet */
            position: absolute;
            right: 0;
            top: 0;
            font-size: 1.2em;
        }
        #hypotheticalServicesCalculator .comparison-title {
            color: #1e90ff; /* Blue for comparison title */
            font-size: 1.1em;
            margin-top: 25px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .food-comparison-list {
            list-style-type: none;
            padding-right: 0;
            margin-top: 10px;
        }
        .food-comparison-list li {
            font-size: 0.9em;
            color: #ccc;
            margin-bottom: 8px;
            line-height: 1.5;
            position: relative;
            padding-right: 18px;
        }
        .food-comparison-list li::before {
            content: "•";
            color: #28a745; /* Green bullet for food */
            position: absolute;
            right: 0;
            top: 0;
            font-size: 1.1em;
        }
        .food-comparison-list strong {
            color: #eee;
        }
        .suggestion-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #555;
            text-align: right;
        }
        .suggestion-section h3 {
            color: #FFA500; /* Orange for suggestion titles */
            font-size: 1.3em;
            margin-bottom: 15px;
            text-align: center;
        }
        .suggestion-section p {
            font-size: 0.95em;
            line-height: 1.8;
            color: #e0e0e0;
            margin-bottom: 10px;
        }
        .suggestion-section ul {
            list-style-type: disc;
            padding-right: 25px;
            margin-bottom: 15px;
        }
        .suggestion-section li {
            margin-bottom: 8px;
            color: #e0e0e0;
        }
        .suggestion-section .highlight {
            color: #8aff8a;
            font-weight: 700;
        }
        .suggestion-section .warning-text {
            color: #ff8a8a; /* Red for warnings */
            font-weight: 700;
        }

        /* Styles for the new detailed activity table */
        .activity-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            text-align: right;
            direction: rtl; /* Ensure table content is RTL */
        }
        .activity-table th, .activity-table td {
            border: 1px solid #555;
            padding: 10px;
            font-size: 0.9em;
            color: #f0f0f0;
        }
        .activity-table th {
            background-color: #4a4a4a;
            color: #FFD700; /* Gold for table headers */
            font-weight: 700;
            text-align: center;
        }
        .activity-table td {
            background-color: #3a3a3a;
        }
        .activity-table td:first-child { /* Activity Name */
            font-weight: 600;
            color: #FFA500; /* Orange for activity names */
        }
        .total-cost-row {
            font-weight: 700;
            background-color: #2a2a2a;
            color: #8aff8a !important; /* Green for total cost */
        }
        .total-cost-row td {
            color: #8aff8a !important; /* Green for total cost cells */
        }
        .total-cost-row.warning {
            color: #ff8a8a !important; /* Red for warning total */
        }
        .total-cost-row.warning td {
            color: #ff8a8a !important; /* Red for warning total cells */
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            .navbar {
                padding: 8px;
                max-width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-button {
                margin: 4px;
                flex-basis: calc(50% - 8px); /* Two buttons per row with gap */
                min-width: unset;
                font-size: 0.85em;
                padding: 10px 15px;
            }
            .app-container {
                padding: 20px;
                max-width: 380px;
            }
            .input-group input[type="number"],
            .input-group input[type="text"],
            .input-group select {
                width: calc(100% - 30px);
                padding: 10px 10px 10px 30px;
            }
            .input-group .icon {
                left: 8px;
                font-size: 1em;
                transform: translateY(calc(-50% + 10px));
            }
            .input-group select {
                padding-left: 8px;
            }
            .personality-text {
                font-size: 0.95em;
                padding: 15px;
            }
            .tab-button {
                font-size: 0.9em;
                padding: 8px 12px;
            }
            .input-with-buttons button {
                width: 30px;
                height: 30px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <button id="themeToggle" class="icon-button"><i class="fas fa-sun"></i></button>

    <div class="navbar">
        <button class="nav-button active" data-target="goldCalculator" data-color="gold">
            <i class="fas fa-coins"></i>
            <span>حسابگر طلا</span>
        </button>
        <button class="nav-button" data-target="bmiCalculator" data-color="green">
            <i class="fas fa-weight"></i>
            <span>شاخص BMI</span>
        </button>
        <button class="nav-button" data-target="personalityTest" data-color="orange">
            <i class="fas fa-user"></i>
            <span>تست شخصیت</span>
        </button>
        <button class="nav-button" data-target="loanDepositCalculator" data-color="purple">
            <i class="fas fa-hand-holding-usd"></i>
            <span>وام و سپرده</span>
        </button>
        <button class="nav-button" data-target="currencyConverter" data-color="blue">
            <i class="fas fa-exchange-alt"></i>
            <span>تبدیل ارز</span>
        </button>
        <button class="nav-button" data-target="hypotheticalServicesCalculator" data-color="red">
            <i class="fas fa-dollar-sign"></i>
            <span>لذت و هزینه‌ها</span>
        </button>
    </div>

    <div id="goldCalculator" class="app-container">
        <h1>حسابگر تعهدات طلا</h1>
        <div class="input-group">
            <label for="goldWeight">وزن طلا (گرم):</label>
            <input type="number" id="goldWeight" placeholder="مثال: 10" step="0.01">
            <i class="fas fa-balance-scale icon"></i>
        </div>
        <div class="input-group">
            <label for="goldPricePerGram">قیمت هر گرم طلا (تومان):</label>
            <input type="number" id="goldPricePerGram" placeholder="مثال: 3,000,000">
            <i class="fas fa-money-bill-wave icon"></i>
        </div>
        <button onclick="calculateGoldCommitment()">محاسبه</button>
        <div id="goldResultDiv" class="result">
            <div>ارزش کل تعهد طلا: <span id="totalGoldValue"></span> تومان</div>
            <div class="small-text">این مبلغ صرفاً یک تخمین است و برای برنامه‌ریزی مالی استفاده شود.</div>
        </div>
    </div>

    <div id="bmiCalculator" class="app-container">
        <h1>شاخص توده بدنی (BMI)</h1>
        <div class="input-group">
            <label for="weight">وزن (کیلوگرم):</label>
            <input type="number" id="weight" placeholder="مثال: 70">
            <i class="fas fa-weight icon"></i>
        </div>
        <div class="input-group">
            <label for="height">قد (سانتی‌متر):</label>
            <input type="number" id="height" placeholder="مثال: 175">
            <i class="fas fa-ruler-vertical icon"></i>
        </div>
        <button onclick="calculateBMI()">محاسبه BMI</button>
        <div id="bmiResultDiv" class="result">
            <div>BMI شما: <span id="bmiValue"></span></div>
            <div>وضعیت: <span id="bmiStatus"></span></div>
            <div class="small-text">شاخص BMI ابزاری برای سنجش تناسب قد و وزن است. برای تشخیص دقیق‌تر، با پزشک مشورت کنید.</div>
        </div>
    </div>

    <div id="personalityTest" class="app-container">
        <h1>تست شخصیت ماه تولد</h1>
        <div class="input-group">
            <label for="birthMonth">ماه تولد خود را انتخاب کنید:</label>
            <select id="birthMonth">
                <option value="">انتخاب کنید</option>
                <option value="فروردین">فروردین</option>
                <option value="اردیبهشت">اردیبهشت</option>
                <option value="خرداد">خرداد</option>
                <option value="تیر">تیر</option>
                <option value="مرداد">مرداد</option>
                <option value="شهریور">شهریور</option>
                <option value="مهر">مهر</option>
                <option value="آبان">آبان</option>
                <option value="آذر">آذر</option>
                <option value="دی">دی</option>
                <option value="بهمن">بهمن</option>
                <option value="اسفند">اسفند</option>
            </select>
            <i class="fas fa-calendar-alt icon"></i>
        </div>
        <button onclick="showPersonalityTraits()">نمایش ویژگی‌ها</button>
        <div id="personalityResultDiv" class="result" style="display: none;">
            <div id="personalityText" class="personality-text"></div>
            <div class="small-text">این ویژگی‌ها بر اساس باورهای عمومی درباره ماه‌های تولد هستند و جنبه سرگرمی دارند.</div>
        </div>

        <div class="comparison-section">
            <label for="compareMonth">مقایسه با ماه تولد دیگر:</label>
            <select id="compareMonth">
                <option value="">انتخاب کنید</option>
                <option value="فروردین">فروردین</option>
                <option value="اردیبهشت">اردیبهشت</option>
                <option value="خرداد">خرداد</option>
                <option value="تیر">تیر</option>
                <option value="مرداد">مرداد</option>
                <option value="شهریور">شهریور</option>
                <option value="مهر">مهر</option>
                <option value="آبان">آبان</option>
                <option value="آذر">آذر</option>
                <option value="دی">دی</option>
                <option value="بهمن">بهمن</option>
                <option value="اسفند">اسفند</option>
            </select>
            <button onclick="comparePersonalities()">مقایسه شخصیت</button>
            <div id="comparisonResultDiv" class="result" style="display: none;">
                <div id="comparisonText" class="comparison-result"></div>
            </div>
        </div>
    </div>

    <div id="loanDepositCalculator" class="app-container">
        <h1>حسابگر وام و سپرده</h1>
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showLoanDepositTab('loan', this)">
                <i class="fas fa-money-check-alt"></i>
                <span>محاسبه وام</span>
            </button>
            <button class="tab-button" onclick="showLoanDepositTab('deposit', this)">
                <i class="fas fa-piggy-bank"></i>
                <span>محاسبه سپرده</span>
            </button>
        </div>

        <div id="loanContent" class="loan-deposit-content" style="display: block;">
            <div class="input-group">
                <label for="loanAmount">مبلغ وام (تومان):</label>
                <input type="number" id="loanAmount" placeholder="مثال: 100,000,000">
                <i class="fas fa-hand-holding-usd icon"></i>
            </div>
            <div class="input-group">
                <label for="loanInterestRate">نرخ سود سالانه (%):</label>
                <input type="number" id="loanInterestRate" placeholder="مثال: 18" step="0.1">
                <i class="fas fa-percent icon"></i>
            </div>
            <div class="input-group">
                <label for="loanDurationMonths">مدت بازپرداخت (ماه):</label>
                <input type="number" id="loanDurationMonths" placeholder="مثال: 60">
                <i class="fas fa-calendar-alt icon"></i>
            </div>
            <button onclick="calculateLoanInstallment()">محاسبه اقساط</button>
            <div id="loanResultDiv" class="result">
                <div>قسط ماهانه: <span id="monthlyInstallment"></span> تومان</div>
                <div>کل سود: <span id="totalLoanInterest"></span> تومان</div>
                <div>کل بازپرداخت: <span id="totalPayment"></span> تومان</div>
                <div class="small-text">این محاسبات تخمینی هستند و برای اطلاعات دقیق‌تر با بانک مشورت کنید.</div>
            </div>
        </div>

        <div id="depositContent" class="loan-deposit-content">
            <div class="input-group">
                <label for="depositAmount">مبلغ سپرده (تومان):</label>
                <input type="number" id="depositAmount" placeholder="مثال: 50,000,000">
                <i class="fas fa-piggy-bank icon"></i>
            </div>
            <div class="input-group">
                <label for="depositInterestRate">نرخ سود سالانه (%):</label>
                <input type="number" id="depositInterestRate" placeholder="مثال: 20" step="0.1">
                <i class="fas fa-percent icon"></i>
            </div>
            <div class="input-group">
                <label id="depositDurationLabel" for="depositDurationDays">مدت زمان سپرده (ماه):</label>
                <input type="number" id="depositDurationDays" placeholder="مثال: 12">
                <i class="fas fa-calendar-alt icon"></i>
            </div>
            <div class="toggle-switch">
                <span>محاسبه سود روزشمار</span>
                <label class="switch">
                    <input type="checkbox" id="dailyInterestToggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <button onclick="calculateDepositInterest()">محاسبه سود</button>
            <div id="depositResultDiv" class="result">
                <div>سود کل سپرده: <span id="totalDepositInterest"></span> تومان</div>
                <div>مبلغ نهایی با سود: <span id="finalDepositAmount"></span> تومان</div>
                <div class="small-text">این محاسبات تخمینی هستند. برای اطلاعات دقیق‌تر با بانک مشورت کنید.</div>
            </div>
        </div>
    </div>

    <div id="currencyConverter" class="app-container">
        <h1>تبدیل ارز</h1>
        <div class="input-group">
            <label for="amountToConvert">مبلغ:</label>
            <input type="number" id="amountToConvert" placeholder="مثال: 1000">
            <i class="fas fa-money-bill-wave icon"></i>
        </div>
        <div class="flex-inputs">
            <div class="input-group">
                <label for="fromCurrency">از ارز:</label>
                <select id="fromCurrency">
                    <option value="IRR">تومان</option>
                    <option value="USD">دلار آمریکا</option>
                    <option value="EUR">یورو</option>
                    <option value="GBP">پوند انگلیس</option>
                </select>
            </div>
            <div class="input-group">
                <label for="toCurrency">به ارز:</label>
                <select id="toCurrency">
                    <option value="USD">دلار آمریکا</option>
                    <option value="IRR">تومان</option>
                    <option value="EUR">یورو</option>
                    <option value="GBP">پوند انگلیس</option>
                </select>
            </div>
        </div>
        <div class="input-group">
            <label for="exchangeRate">نرخ تبدیل (مثلاً 1 دلار چند تومان است):</label>
            <input type="number" id="exchangeRate" placeholder="مثال: 50000" step="0.01">
            <i class="fas fa-percentage icon"></i>
        </div>
        <button onclick="convertCurrency()">تبدیل</button>
        <div id="currencyResultDiv" class="result">
            <div>مبلغ تبدیل شده: <span id="convertedAmount"></span></div>
            <div class="small-text">نرخ‌های تبدیل ارز دائماً در حال تغییر هستند. این ارقام صرفاً جهت اطلاع‌رسانی می‌باشند.</div>
        </div>
    </div>

    <div id="hypotheticalServicesCalculator" class="app-container">
        <h1>هزینه‌ها و لذت ماهانه</h1>
        <div class="input-group">
            <label for="dollarExchangeRateHyp">نرخ لحظه‌ای دلار (تومان):</label>
            <input type="number" id="dollarExchangeRateHyp" placeholder="مثال: 55000" value="55000">
            <i class="fas fa-dollar-sign icon"></i>
        </div>
        <div class="input-group">
            <label for="monthlyIncomeHyp">درآمد ماهانه (تومان):</label>
            <input type="number" id="monthlyIncomeHyp" placeholder="مثال: 30,000,000">
            <i class="fas fa-wallet icon"></i>
        </div>
        <p style="text-align: right; color: #e0e0e0; font-size: 0.9em; margin-top: 20px; margin-bottom: 15px;">فعالیت‌های ماهانه مورد نظر خود را انتخاب کنید:</p>
        <div id="activityOptions">
            </div>
        <button onclick="calculateHypotheticalServicesCost()">محاسبه هزینه‌ها و بودجه</button>

        <div id="hypotheticalServicesResultDiv" class="result">
            <table class="activity-table">
                <thead>
                    <tr>
                        <th>فعالیت</th>
                        <th>تعداد/دفعات</th>
                        <th>هزینه (تومان)</th>
                    </tr>
                </thead>
                <tbody id="activityTableBody">
                    </tbody>
                <tfoot>
                    <tr id="totalCostRow" class="total-cost-row">
                        <td colspan="2">جمع کل هزینه‌های انتخابی:</td>
                        <td id="totalActivityCostSpan"></td>
                    </tr>
                </tfoot>
            </table>
            <div class="suggestion-section">
                <h3 id="budgetSuggestionTitle"></h3>
                <p id="budgetSuggestionText"></p>
                <ul id="suggestionList" style="display: none;"></ul>
            </div>
            <div class="small-text">این تخمین‌ها بر اساس میانگین هزینه‌ها هستند و ممکن است با واقعیت متفاوت باشند.</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Theme Toggle
            const themeToggleBtn = document.getElementById('themeToggle');
            const body = document.body;

            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('light-theme');
                if (body.classList.contains('light-theme')) {
                    themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
                } else {
                    themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
                }
                localStorage.setItem('theme', body.classList.contains('light-theme') ? 'light' : 'dark');
            });

            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                body.classList.add('light-theme');
                themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                body.classList.remove('light-theme');
                themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Navbar Button Logic
            const navButtons = document.querySelectorAll('.nav-button');
            const appContainers = document.querySelectorAll('.app-container');

            function showApp(targetId) {
                appContainers.forEach(container => {
                    container.style.display = 'none';
                });
                document.getElementById(targetId).style.display = 'block';
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    showApp(button.dataset.target);
                });
            });

            // Show the first app by default on load
            if (navButtons.length > 0) {
                navButtons[0].click();
            }

            // Loan/Deposit Calculator tab logic
            document.getElementById('dailyInterestToggle').addEventListener('change', updateDepositDurationLabel);
            updateDepositDurationLabel();

            // Event listener for marital status to show/hide children count (inside personality or wherever applicable)
            // This part might need adjustment if marital status is global but not in this specific app
            const maritalStatusEl = document.getElementById('maritalStatus');
            if (maritalStatusEl) {
                maritalStatusEl.addEventListener('change', function() {
                    document.getElementById('childrenCountGroup').style.display = this.value === 'متاهل' ? 'block' : 'none';
                });
                maritalStatusEl.dispatchEvent(new Event('change')); // Initial dispatch
            }

            // Initialize hypothetical services activities
            populateActivityOptions();
        });

        // --- Global Data (Removed as per user request) ---
        // let globalUserData = {};

        // --- Gold Calculator Logic ---
        function calculateGoldCommitment() {
            const goldWeight = parseFloat(document.getElementById('goldWeight').value);
            const goldPricePerGram = parseFloat(document.getElementById('goldPricePerGram').value);

            if (isNaN(goldWeight) || isNaN(goldPricePerGram) || goldWeight <= 0 || goldPricePerGram <= 0) {
                alert('لطفاً وزن و قیمت طلا را با مقادیر صحیح وارد کنید.');
                return;
            }

            const totalValue = goldWeight * goldPricePerGram;
            document.getElementById('totalGoldValue').innerText = totalValue.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('goldResultDiv').style.display = 'block';
        }

        // --- BMI Calculator Logic ---
        function calculateBMI() {
            const weight = parseFloat(document.getElementById('weight').value);
            const heightCm = parseFloat(document.getElementById('height').value);

            if (isNaN(weight) || isNaN(heightCm) || weight <= 0 || heightCm <= 0) {
                alert('لطفاً وزن و قد را با مقادیر صحیح وارد کنید.');
                return;
            }

            const heightM = heightCm / 100;
            const bmi = weight / (heightM * heightM);
            let status = '';

            if (bmi < 18.5) {
                status = 'کم‌وزن';
            } else if (bmi >= 18.5 && bmi < 24.9) {
                status = 'وزن طبیعی';
            } else if (bmi >= 25 && bmi < 29.9) {
                status = 'اضافه‌وزن';
            } else {
                status = 'چاق';
            }

            document.getElementById('bmiValue').innerText = bmi.toFixed(2);
            document.getElementById('bmiStatus').innerText = status;
            document.getElementById('bmiResultDiv').style.display = 'block';
        }

        // --- Personality Test Logic ---
        const personalityTraits = {
            'فروردین': {
                'قوت': ['پر انرژی', 'جسور', 'پیشرو', 'صادق'],
                'ضعف': ['بی‌صبر', 'تکانشی', 'خودمحور', 'عجول']
            },
            'اردیبهشت': {
                'قوت': ['صبور', 'قابل اعتماد', 'پایدار', 'هدفمند'],
                'ضعف': ['لجباز', 'حسود', 'خودشیفته', 'تنبلی']
            },
            'خرداد': {
                'قوت': ['هوشمند', 'تطبیق‌پذیر', 'اجتماعی', 'شوخ‌طبع'],
                'ضعف': ['دوگانگی', 'دمدمی مزاج', 'غیرقابل اعتماد', 'کنجکاوی زیاد']
            },
            'تیر': {
                'قوت': ['دلسوز', 'محافظه‌کار', 'وفادار', 'شهودی'],
                'ضعف': ['حساس', 'بدخلق', 'وابسته', 'گوشه‌گیر']
            },
            'مرداد': {
                'قوت': ['با اعتماد به نفس', 'سخاوتمند', 'کاریزماتیک', 'وفادار'],
                'ضعف': ['خودبین', 'مغرور', 'کنترل‌گر', 'دراماتیک']
            },
            'شهریور': {
                'قوت': ['تحلیل‌گر', 'کمال‌گرا', 'مسئولیت‌پذیر', 'مهربان'],
                'ضعف': ['انتقادگر', 'وسواسی', 'بیش از حد نگران', 'ترسو']
            },
            'مهر': {
                'قوت': ['عادلانه‌جو', 'هماهنگ', 'جذاب', 'دیپلماتیک'],
                'ضعف': ['بی‌تصمیم', 'سطحی‌نگر', 'متأثر', 'دمدمی']
            },
            'آبان': {
                'قوت': ['پرشور', 'قاطع', 'مراقب', 'باهوش'],
                'ضعف': ['حسود', 'پنهان‌کار', 'کینه توز', 'کنترل‌گر']
            },
            'آذر': {
                'قوت': ['خوش‌بین', 'ماجراجو', 'فلسفی', 'صادق'],
                'ضعف': ['بی‌پروا', 'بی‌ملاحظه', 'بی‌قرار', 'سطحی']
            },
            'دی': {
                'قوت': ['منظم', 'مسئولیت‌پذیر', 'صبور', 'کاردان'],
                'ضعف': ['بدبین', 'سرد', 'لجباز', 'محتاط بیش از حد']
            },
            'بهمن': {
                'قوت': ['خلاق', 'مستقل', 'بشر دوست', 'منطقی'],
                'ضعف': ['گریزان', 'غیرقابل پیش‌بینی', 'سرد', 'گوشه‌گیر']
            },
            'اسفند': {
                'قوت': ['دلسوز', 'خیال‌پرداز', 'همدل', 'مهربان'],
                'ضعف': ['زودباور', 'گریزان از واقعیت', 'ترسو', 'ناامید']
            }
        };

        function showPersonalityTraits() {
            const birthMonth = document.getElementById('birthMonth').value;
            const personalityTextDiv = document.getElementById('personalityText');
            const personalityResultDiv = document.getElementById('personalityResultDiv');

            if (!birthMonth) {
                alert('لطفاً ماه تولد خود را انتخاب کنید.');
                return;
            }

            const traits = personalityTraits[birthMonth];
            let html = `<h2>ویژگی‌های شخصیتی متولد ${birthMonth}:</h2>`;
            html += `<h3>نقاط قوت:</h3><ul>`;
            traits['قوت'].forEach(p => {
                html += `<li><span class="positive-point">${p}</span></li>`;
            });
            html += `</ul>`;
            html += `<h3>نقاط ضعف (نیاز به توجه):</h3><ul>`;
            traits['ضعف'].forEach(n => {
                html += `<li><span class="negative-point">${n}</span></li>`;
            });
            html += `</ul>`;

            personalityTextDiv.innerHTML = html;
            personalityResultDiv.style.display = 'block';
        }

        function comparePersonalities() {
            const userMonth = document.getElementById('birthMonth').value;
            const compareMonth = document.getElementById('compareMonth').value;

            if (!userMonth || !compareMonth) {
                alert('لطفاً هر دو ماه تولد را برای مقایسه انتخاب کنید.');
                return;
            }
            if (userMonth === compareMonth) {
                alert('لطفاً دو ماه متفاوت را برای مقایسه انتخاب کنید.');
                return;
            }

            const [userT, compareT] = [personalityTraits[userMonth], personalityTraits[compareMonth]];

            const commonP = userT['قوت'].filter(t => compareT['قوت'].includes(t));
            const commonN = userT['ضعف'].filter(t => compareT['ضعف'].includes(t));

            const userUniqueP = userT['قوت'].filter(t => !compareT['قوت'].includes(t));
            const compareUniqueP = compareT['قوت'].filter(t => !userT['قوت'].includes(t));

            let html = `<h3>مقایسه شخصیت متولد ${userMonth} با متولد ${compareMonth}:</h3>`;

            html += `<p><strong>نقاط مشترک مثبت:</strong> ${commonP.length ? commonP.map(t => `<span class="positive-point">${t}</span>`).join('، ') : 'مورد قابل توجهی یافت نشد.'}</p>`;
            if (userUniqueP.length || compareUniqueP.length) {
                html += `<p><strong>نقاط قوت متفاوت:</strong></p><ul>`;
                userUniqueP.forEach(t => html += `<li>متولد ${userMonth}: ${t}</li>`);
                compareUniqueP.forEach(t => html += `<li>متولد ${compareMonth}: ${t}</li>`);
                html += `</ul>`;
            }
            html += `<p><strong>نقاط مشترک منفی (نیاز به توجه):</strong> ${commonN.length ? commonN.map(t => `<span class="negative-point">${t}</span>`).join('، ') : 'مورد قابل توجهی یافت نشد.'}</p>`;

            const compatibilityScore = commonP.length * 2 - commonN.length * 2;
            let compatibilityStatement = compatibilityScore >= 3 ? "شما و متولد این ماه شباهت‌های مثبتی زیادی دارید و احتمالاً به خوبی با هم کنار می‌آیید. تفاهم کلی شما بالاست." : compatibilityScore >= 0 ? "شما و متولد این ماه می‌توانید در بسیاری از زمینه‌ها تفاهم داشته باشید، با کمی درک متقابل و پذیرش تفاوت‌ها." : "ممکن است در برخی زمینه‌ها چالش‌هایی در تفاهم با متولد این ماه داشته باشید. نیاز به درک بیشتر از تفاوت‌ها و تلاش برای سازگاری است.";
            html += `<p><strong>نتیجه کلی تفاهم:</strong> ${compatibilityStatement}</p>`;

            document.getElementById('comparisonText').innerHTML = html;
            document.getElementById('comparisonResultDiv').style.display = 'block';
        }

        // --- Loan/Deposit Calculator Logic (Concise) ---
        function showLoanDepositTab(tabId, clickedButton) {
            document.querySelectorAll('.loan-deposit-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId + 'Content').style.display = 'block';
            clickedButton.classList.add('active');
            document.getElementById('depositResultDiv').style.display = 'none';
            document.getElementById('loanResultDiv').style.display = 'none';
            if (tabId === 'deposit') {
                document.getElementById('depositAmount').value = '';
                document.getElementById('depositInterestRate').value = '';
                document.getElementById('depositDurationDays').value = '';
                document.getElementById('dailyInterestToggle').checked = false;
                updateDepositDurationLabel();
            } else {
                document.getElementById('loanAmount').value = '';
                document.getElementById('loanInterestRate').value = '';
                document.getElementById('loanDurationMonths').value = '';
            }
        }

        function updateDepositDurationLabel() {
            document.getElementById('depositDurationLabel').innerText = document.getElementById('dailyInterestToggle').checked ? 'مدت زمان سپرده (روز):' : 'مدت زمان سپرده (ماه):';
        }

        function calculateDepositInterest() {
            const [amount, rate, durationInput] = ['depositAmount', 'depositInterestRate', 'depositDurationDays'].map(id => parseFloat(document.getElementById(id).value));
            const isDaily = document.getElementById('dailyInterestToggle').checked;

            if (isNaN(amount) || amount <= 0 || isNaN(rate) || rate < 0 || isNaN(durationInput) || durationInput <= 0) {
                alert('لطفاً تمام فیلدها را با مقادیر صحیح وارد کنید.');
                return;
            }

            let totalInterest, finalAmount;
            if (isDaily) {
                totalInterest = amount * (rate / 100) / 365 * durationInput;
            } else {
                totalInterest = amount * (rate / 100) / 12 * durationInput;
            }
            finalAmount = amount + totalInterest;

            document.getElementById('totalDepositInterest').innerText = totalInterest.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('finalDepositAmount').innerText = finalAmount.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('depositResultDiv').style.display = 'block';
        }

        function calculateLoanInstallment() {
            const [amount, rate, duration] = ['loanAmount', 'loanInterestRate', 'loanDurationMonths'].map(id => parseFloat(document.getElementById(id).value));

            if (isNaN(amount) || amount <= 0 || isNaN(rate) || rate < 0 || isNaN(duration) || duration <= 0) {
                alert('لطفاً تمام فیلدها را با مقادیر صحیح وارد کنید.');
                return;
            }

            const monthlyRate = (rate / 100) / 12;
            let monthlyInstallment, totalInterest, totalPayment;

            if (monthlyRate === 0) {
                monthlyInstallment = amount / duration;
                totalInterest = 0;
                totalPayment = amount;
            } else {
                monthlyInstallment = amount * monthlyRate * Math.pow(1 + monthlyRate, duration) / (Math.pow(1 + monthlyRate, duration) - 1);
                totalPayment = monthlyInstallment * duration;
                totalInterest = totalPayment - amount;
            }

            document.getElementById('monthlyInstallment').innerText = monthlyInstallment.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('totalLoanInterest').innerText = totalInterest.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('totalPayment').innerText = totalPayment.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            document.getElementById('loanResultDiv').style.display = 'block';
        }

        // --- Currency Converter Logic ---
        function convertCurrency() {
            const amount = parseFloat(document.getElementById('amountToConvert').value);
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);

            if (isNaN(amount) || amount <= 0 || isNaN(exchangeRate) || exchangeRate <= 0) {
                alert('لطفاً مبلغ و نرخ تبدیل را با مقادیر صحیح وارد کنید.');
                return;
            }

            let convertedAmount;
            // Simple conversion logic based on user-provided rate
            if (fromCurrency === 'IRR' && toCurrency === 'USD') {
                convertedAmount = amount / exchangeRate;
            } else if (fromCurrency === 'USD' && toCurrency === 'IRR') {
                convertedAmount = amount * exchangeRate;
            } else if (fromCurrency === 'IRR' && toCurrency === 'EUR') {
                // Assuming exchangeRate is USD_to_IRR, need another rate for EUR
                alert('برای تبدیل مستقیم تومان به یورو، نرخ تبدیل یورو به تومان را وارد کنید.');
                return;
            } else if (fromCurrency === 'EUR' && toCurrency === 'IRR') {
                alert('برای تبدیل مستقیم یورو به تومان، نرخ تبدیل یورو به تومان را وارد کنید.');
                return;
            } else if (fromCurrency === 'USD' && toCurrency === 'EUR') {
                // Simplified, needs actual cross-rate or go via IRR if exchangeRate is to IRR
                convertedAmount = amount * (1 / 1.08); // Assuming 1 EUR = 1.08 USD
            } else if (fromCurrency === 'EUR' && toCurrency === 'USD') {
                convertedAmount = amount * 1.08; // Assuming 1 EUR = 1.08 USD
            } else if (fromCurrency === toCurrency) {
                convertedAmount = amount;
            } else {
                alert('تبدیل بین این ارزها با نرخ وارد شده پشتیبانی نمی‌شود. لطفاً نرخ مربوطه را وارد کنید.');
                return;
            }

            document.getElementById('convertedAmount').innerText = convertedAmount.toLocaleString('fa-IR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ' + toCurrency;
            document.getElementById('currencyResultDiv').style.display = 'block';
        }

        // --- Hypothetical Services Calculator Logic ---
        const iranianServiceCostsUSD = {
            'یک فنجان قهوه در کافه': { min: 2, max: 5, type: 'recreational' },
            'بلیط سینما و یک نوشیدنی': { min: 4, max: 8, type: 'recreational' },
            'یک وعده غذای فست فود': { min: 3, max: 7, type: 'recreational' },
            'یک وعده غذای رستورانی (اقتصادی)': { min: 5, max: 12, type: 'essential' },
            'یک وعده غذای رستورانی (متوسط)': { min: 10, max: 20, type: 'recreational' },
            'یک وعده غذای رستورانی (لوکس)': { min: 20, max: 50, type: 'luxury' },
            'هزینه اینترنت (ماهانه)': { min: 5, max: 15, type: 'essential' },
            'شارژ تلفن همراه (ماهانه)': { min: 3, max: 10, type: 'essential' },
            'حمل و نقل عمومی (ماهانه)': { min: 7, max: 20, type: 'essential' },
            'تاکسی (یک بار)': { min: 1.5, max: 4, type: 'essential' },
            'خرید یک لباس جدید (متوسط)': { min: 15, max: 50, type: 'discretionary' },
            'آرایشگاه مردانه/زنانه': { min: 3, max: 15, type: 'discretionary' },
            'لوازم بهداشتی و آرایشی (ماهانه)': { min: 10, max: 30, type: 'essential' },
            'داروهای بدون نسخه (ماهانه)': { min: 2, max: 8, type: 'essential' },
            'اشتراک پلتفرم فیلم/سریال': { min: 3, max: 8, type: 'recreational' },
            'کنسرت/تئاتر (یک بار)': { min: 8, max: 25, type: 'luxury' },
            'تفریح/بازی گروهی (یک بار)': { min: 2, max: 6, type: 'recreational' },
            'شهریه باشگاه ورزشی (ماهانه)': { min: 6, max: 20, type: 'health' },
            'یک بار استفاده از استخر': { min: 2, max: 4, type: 'health' },
            'کلاس آموزشی آنلاین/ورزش‌های انفرادی (ماهانه)': { min: 2, max: 10, type: 'education' },
            'خرید یک کتاب جدید': { min: 1.5, max: 4, type: 'education' },
            'اشتراک ماهانه نرم‌افزار کاربردی': { min: 2, max: 10, type: 'education' },
            'هزینه مسافرت (به ازای هر نفر در روز، اقتصادی)': { min: 15, max: 40, type: 'discretionary' },
            'هزینه مسافرت (به ازای هر نفر در روز، رفاهی)': { min: 40, max: 100, type: 'luxury' },
            'هزینه یک پاکت سیگار': { min: 0.5, max: 1, type: 'vice' },
            'هزینه یک بطری مشروب (عرق سگی 1.5 لیتری)': { min: 10, max: 10, type: 'vice' },
            'هزینه یک بطری ویسکی': { min: 50, max: 50, type: 'vice' }
        };

        const categories = {
            'نوشیدنی و خوراک': ['یک فنجان قهوه در کافه', 'یک وعده غذای فست فود', 'یک وعده غذای رستورانی (اقتصادی)', 'یک وعده غذای رستورانی (متوسط)', 'یک وعده غذای رستورانی (لوکس)'],
            'سرگرمی و فرهنگ': ['بلیط سینما و یک نوشیدنی', 'اشتراک پلتفرم فیلم/سریال', 'کنسرت/تئاتر (یک بار)', 'تفریح/بازی گروهی (یک بار)'],
            'سلامت و ورزش': ['شهریه باشگاه ورزشی (ماهانه)', 'یک بار استفاده از استخر', 'کلاس آموزشی آنلاین/ورزش‌های انفرادی (ماهانه)'],
            'آموزش و توسعه فردی': ['خرید یک کتاب جدید', 'اشتراک ماهانه نرم‌افزار کاربردی'],
            'خدمات و ارتباطات': ['هزینه اینترنت (ماهانه)', 'شارژ تلفن همراه (ماهانه)'],
            'حمل و نقل': ['حمل و نقل عمومی (ماهانه)', 'تاکسی (یک بار)'],
            'پوشاک و بهداشت': ['خرید یک لباس جدید (متوسط)', 'آرایشگاه مردانه/زنانه', 'لوازم بهداشتی و آرایشی (ماهانه)', 'داروهای بدون نسخه (ماهانه)'],
            'سفر': ['هزینه مسافرت (به ازای هر نفر در روز، اقتصادی)', 'هزینه مسافرت (به ازای هر نفر در روز، رفاهی)'],
            'سایر تفریحات': ['هزینه یک پاکت سیگار', 'هزینه یک بطری مشروب (عرق سگی 1.5 لیتری)', 'هزینه یک بطری ویسکی']
        };

        function populateActivityOptions() {
            const activityOptionsDiv = document.getElementById('activityOptions');
            activityOptionsDiv.innerHTML = ''; // Clear previous options

            for (const category in categories) {
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'category-item';
                categoryTitle.innerText = category;
                activityOptionsDiv.appendChild(categoryTitle);

                categories[category].forEach(activityName => {
                    const activity = iranianServiceCostsUSD[activityName];
                    const activityItemDiv = document.createElement('div');
                    activityItemDiv.className = 'activity-item-option';

                    const label = document.createElement('label');
                    label.htmlFor = `activity-${activityName.replace(/\s/g, '-')}`;
                    label.innerText = activityName;

                    const inputContainer = document.createElement('div');
                    inputContainer.className = 'input-with-buttons';

                    const decreaseButton = document.createElement('button');
                    decreaseButton.innerText = '-';
                    decreaseButton.type = 'button';
                    decreaseButton.onclick = () => adjustActivityCount(`activity-${activityName.replace(/\s/g, '-')}`, -1);

                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `activity-${activityName.replace(/\s/g, '-')}`;
                    input.value = 0;
                    input.min = 0;
                    input.style.direction = 'ltr';
                    input.style.textAlign = 'center';
                    input.addEventListener('change', calculateHypotheticalServicesCost); // Recalculate on manual change

                    const increaseButton = document.createElement('button');
                    increaseButton.innerText = '+';
                    increaseButton.type = 'button';
                    increaseButton.onclick = () => adjustActivityCount(`activity-${activityName.replace(/\s/g, '-')}`, 1);

                    inputContainer.appendChild(decreaseButton);
                    inputContainer.appendChild(input);
                    inputContainer.appendChild(increaseButton);

                    activityItemDiv.appendChild(label);
                    activityItemDiv.appendChild(inputContainer);
                    activityOptionsDiv.appendChild(activityItemDiv);
                });
            }
        }

        function adjustActivityCount(inputId, change) {
            const input = document.getElementById(inputId);
            let currentValue = parseInt(input.value);
            if (isNaN(currentValue)) currentValue = 0;
            const newValue = Math.max(0, currentValue + change); // Ensure non-negative
            input.value = newValue;
            calculateHypotheticalServicesCost(); // Recalculate after adjustment
        }

        function calculateHypotheticalServicesCost() {
            const dollarRate = parseFloat(document.getElementById('dollarExchangeRateHyp').value);
            const monthlyIncome = parseFloat(document.getElementById('monthlyIncomeHyp').value);

            if (isNaN(dollarRate) || dollarRate <= 0) {
                alert('لطفاً نرخ دلار را با مقدار صحیح وارد کنید.');
                return;
            }
            if (isNaN(monthlyIncome) || monthlyIncome < 0) {
                alert('لطفاً درآمد ماهانه را با مقدار صحیح وارد کنید.');
                return;
            }

            let totalSuggestedActivityCostUSD = 0;
            const activityTableBody = document.getElementById('activityTableBody');
            activityTableBody.innerHTML = ''; // Clear previous results

            let selectedActivities = [];

            for (const category in categories) {
                categories[category].forEach(activityName => {
                    const inputId = `activity-${activityName.replace(/\s/g, '-')}`;
                    const activityInput = document.getElementById(inputId);
                    if (activityInput && parseInt(activityInput.value) > 0) {
                        const count = parseInt(activityInput.value);
                        const activity = iranianServiceCostsUSD[activityName];
                        // Using average cost for calculation
                        const costUSD = ((activity.min + activity.max) / 2) * count;
                        totalSuggestedActivityCostUSD += costUSD;
                        selectedActivities.push({
                            name: activityName,
                            count: count,
                            costUSD: costUSD,
                            type: activity.type
                        });
                    }
                });
            }

            // Sort selected activities for display and suggestion purposes (e.g., recreational first)
            selectedActivities.sort((a, b) => {
                const typeOrder = { 'luxury': 1, 'recreational': 2, 'discretionary': 3, 'vice': 4, 'essential': 5, 'health': 6, 'education': 7 };
                return typeOrder[a.type] - typeOrder[b.type];
            });


            selectedActivities.forEach(activity => {
                const row = activityTableBody.insertRow();
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                const cell3 = row.insertCell(2);
                const costToman = activity.costUSD * dollarRate;
                cell1.innerText = activity.name;
                cell2.innerText = `${activity.count} بار`; // Display count with "بار"
                cell3.innerText = costToman.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) + ' تومان';
            });

            const totalActivityCostToman = totalSuggestedActivityCostUSD * dollarRate;
            document.getElementById('totalActivityCostSpan').innerText = totalActivityCostToman.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) + ' تومان';

            const remainingBalance = monthlyIncome - totalActivityCostToman;
            const budgetSuggestionTitle = document.getElementById('budgetSuggestionTitle');
            const budgetSuggestionText = document.getElementById('budgetSuggestionText');
            const suggestionList = document.getElementById('suggestionList');
            const totalCostRow = document.getElementById('totalCostRow');

            suggestionList.innerHTML = ''; // Clear previous suggestions
            suggestionList.style.display = 'none'; // Hide by default

            if (remainingBalance >= 0) {
                budgetSuggestionTitle.innerText = 'وضعیت بودجه شما: عالی!';
                budgetSuggestionText.innerHTML = `تبریک! شما <span class="highlight">${remainingBalance.toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} تومان</span> مازاد بر نیاز دارید. می‌توانید این مبلغ را پس‌انداز یا سرمایه‌گذاری کنید.`;
                totalCostRow.classList.remove('warning');
            } else {
                budgetSuggestionTitle.innerText = 'هشدار بودجه: کسری هزینه!';
                budgetSuggestionText.innerHTML = `<span class="warning-text">شما ${(-remainingBalance).toLocaleString('fa-IR', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} تومان کسری بودجه دارید.</span> برای اینکه دخل و خرجتان به هم بخورد، باید برخی از هزینه‌ها را کاهش دهید. پیشنهاد می‌کنیم موارد زیر را تعدیل کنید:`;
                totalCostRow.classList.add('warning');
                suggestionList.style.display = 'block';

                // Suggest items to cut, starting from luxury/recreational/vice
                const itemsToSuggestForCutting = selectedActivities.filter(activity =>
                    ['luxury', 'recreational', 'discretionary', 'vice'].includes(activity.type) && activity.count > 0
                ).sort((a, b) => b.costUSD - a.costUSD); // Sort by highest cost first

                if (itemsToSuggestForCutting.length === 0) {
                    budgetSuggestionText.innerHTML += "<br> شما هیچ هزینه تفریحی قابل حذفی انتخاب نکرده‌اید. باید در هزینه‌های ضروری خود بازنگری کنید.";
                } else {
                    let deficit = -remainingBalance;
                    let suggestedCutAmount = 0;
                    for (const activity of itemsToSuggestForCutting) {
                        if (suggestedCutAmount < deficit) {
                            const li = document.createElement('li');
                            const costToman = activity.costUSD * dollarRate;
                            let cutSuggestion = '';

                            if (activity.type === 'vice' || activity.type === 'luxury' || activity.count > 1) {
                                cutSuggestion = `کاهش ${activity.name} (${activity.count} بار, ${costToman.toLocaleString('fa-IR')} تومان)`;
                                // Simple reduction logic: suggest removing one instance or more if significant cost
                                const potentialSavings = (activity.costUSD / activity.count) * dollarRate;
                                suggestedCutAmount += potentialSavings;
                            } else {
                                cutSuggestion = `کاهش ${activity.name} (${costToman.toLocaleString('fa-IR')} تومان)`;
                                suggestedCutAmount += costToman;
                            }

                            li.innerHTML = `<span class="negative-point">${cutSuggestion}</span>`;
                            suggestionList.appendChild(li);
                        } else {
                            break;
                        }
                    }
                    if (suggestedCutAmount < deficit) {
                         budgetSuggestionText.innerHTML += "<br>با تعدیل موارد بالا هنوز هم کسری بودجه دارید. باید در سایر هزینه‌های خود نیز بازنگری کنید.";
                    }
                }
            }

            document.getElementById('hypotheticalServicesResultDiv').style.display = 'block';
        }

        // Initial population of activities when the page loads
        populateActivityOptions();

    </script>
</body>
</html>
